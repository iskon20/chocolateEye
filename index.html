<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="imgs/logo.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход | Chocolate Eye</title>
    <link rel="stylesheet" href="static/style.css" />

    <style>
      body{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <img src="imgs/logo.png" width="160px" alt="">
      <h2>Авторизация | Вход</h2>
      <input id="name" placeholder="Ваше имя" />
      <input id="passOwn" placeholder="Личный пароль" type="password" />
      <input id="pass" placeholder="Общий пароль" type="password" />
      <button id="reg">Войти</button>
    </div>

    <script>
      const API = "https://chocolateeyeserver-production.up.railway.app/api";

      document.getElementById("reg").onclick = async () => {
        const nameEl = document.getElementById("name");
        const passOwn = document.getElementById("passOwn");
        const passEl = document.getElementById("pass");

        const body = {
          name: nameEl.value.trim(),
          shared_password: passEl.value.trim(),
          password: passOwn.value.trim(),
        };

        const res = await fetch(`${API}/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        const data = await res.json();
        if (data.token) {
          localStorage.setItem("session", data.token);
          location.href = "static/main.html";
        } else {
          alert(data.error || "Ошибка регистрации");
        }
      };
    </script>
  </body>
</html>
